var HSite=(function(window){var doc=window.document;if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}var isOpera=Object.prototype.toString.call(window.opera)=="[object Opera]",isIE=!!(!isOpera&&window.attachEvent),isIE6=!!(isIE&&!window.XMLHttpRequest);return{isOpera:isOpera,isIE:isIE,isIE6:isIE6,isIE9:document.documentMode==9,domReady:(function(){if(window.T){return T.dom.ready}else{return null}})(),getPosition:(function(){if(window.T){return T.dom.getPosition}else{return null}})(),isLeftBtn:function(e){return(this.isIE9||(this.isIE&&e.button==1||!this.isIE&&e.button==0))},isSupportClassList:"classList" in document.createElement("div"),getCharLength:function(s){var tempt=s.replace(/[\u4E00-\u9FA5]/g,"aaa");return tempt.length},setOpacity:function(el,i){if(window.getComputedStyle){el.style.opacity=i}else{if(document.documentElement.currentStyle){if(!el.currentStyle.hasLayout){el.style.zoom=1}if(!el.currentStyle.hasLayout){el.style.display="inline-block"}try{if(el.filters){if(el.filters("alpha")){el.filters("alpha").opacity=i*100}else{el.style.filter+="alpha(opacity="+i*100+")"}}}catch(e){el.style.filter="alpha(opacity="+i*100+")"}}}},getMousePos:function(ev){if(ev.pageX||ev.pageY){return{x:ev.pageX,y:ev.pageY}}if(document.documentElement&&document.documentElement.scrollTop){return{x:ev.clientX+document.documentElement.scrollLeft-document.documentElement.clientLeft,y:ev.clientY+document.documentElement.scrollTop-document.documentElement.clientTop}}else{if(document.body){return{x:ev.clientX+document.body.scrollLeft-document.body.clientLeft,y:ev.clientY+document.body.scrollTop-document.body.clientTop}}}},extend:function(destination,source,isForce){destination=destination||{};for(var property in source){if(isForce){destination[property]=source[property]}else{if(!destination.hasOwnProperty(property)){destination[property]=source[property]}}}return destination},getQuerySring:function(){var s=window.location.search,result={},key,value,item;if(s.length>1){s=s.substring(1);s=s.split("&")}for(var i=0;i<s.length;i++){item=s[i].split("=");result[item[0]]=item[1]}return result},callServer:function(url,options){var scriptNode=null,head=document.getElementsByTagName("head")[0];options=options||{};var callback=options.callback,oldNode=this.scriptNode;scriptNode=document.createElement("script");scriptNode.src=url;scriptNode.async=true;scriptNode.type="text/javascript";scriptNode.onload=scriptNode.onreadystatechange=function(){if(scriptNode.readyState&&scriptNode.readyState=="loading"){return}if(callback){callback(true)}};if(callback){scriptNode.onerror=function(){callback(false)}}if(oldNode){head.replaceChild(scriptNode,oldNode)}else{head.appendChild(scriptNode)}},format:function format(exp){var v=Array.prototype.slice.call(arguments,1);return exp.replace(/{\d}/g,function(holder){var index=holder.charAt(1);return v[index]})},imageRequest:function(url,callback){var r=new Date().getTime(),key="imageRequest"+r,img=new Image();window[key]=img;img.onload=function(){window[key]=null;callback("success")};img.onerror=function(){window[key]=null;callback("error")};img.src=url},ievent:{addEventListener:function(type,fun){this._events[type].push(fun)},removeEventListener:function(type,fun){var e=this._events[type];for(var i=0;i<e.length;i++){if(e[i]===fun){e.splice(i,1)}}},dispatchEvent:function(type,data){var e=this._events[type];for(var i=0;i<e.length;i++){e[i](data)}}},g:function(id){return document.getElementById(id)},getRequest:(function(){if(window.XMLHttpRequest){return function(){return new window.XMLHttpRequest()}}else{return function(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}}})(),ajaxJson:function(url,callback,options){options=HSite.extend(options,{type:"get",cache:false,timeout:10,key:100});var timeoutHandler=window.setTimeout(function(){xhr.abort();callback({code:588})},options.timeout*1000);var xhr=HSite.getRequest();if(!options.cache&&options.type=="get"){if(url.indexOf("?")>0){url=url+"&key="+options.key+"&t="+new Date().getTime()}else{url=url+"?key="+options.key+"&t="+new Date().getTime()}}xhr.open(options.type,url);if(options.type==="post"){xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var data=options.data,sendData=[];data.key=options.key;for(var key in data){sendData.push(HSite.format("{0}={1}",window.encodeURIComponent(key),window.encodeURIComponent(data[key])))}xhr.send(sendData.join("&"))}else{xhr.send(null)}xhr.onreadystatechange=function(){if(xhr.readyState==4){window.clearTimeout(timeoutHandler);if(xhr.status>=200&&xhr.status<300||xhr.status==304){var result=eval("("+xhr.responseText+")");if(!result.code){result.code=200}callback(result)}else{callback({code:599,status:xhr.status})}}}},ajaxSyn:function(url,options){},fineEvent:function(e){e=e||window.event;if(!e.target){e.target=e.srcElement;e.preventDefault=function(){window.returnValue=false};e.stopPropagation=function(){e.cancelBubble=true}}if(e.target.tagName){e.srcName=e.target.tagName.toLowerCase()}return e},on:doc.addEventListener?function(el,type,fun){el.addEventListener(type,fun,false)}:function(el,type,fun){el.attachEvent("on"+type,fun)},off:function(e,type,handler){if(e.addEventListener){e.removeEventListener(type,handler)}else{e.detachEvent("on"+type,handler)}},containClass:function(e,name){if(e.className.indexOf(name)>0){return true}else{return false}},addClass:function(e,name){name=name.trim();if(this.isSupportClassList){e.classList.add(name)}else{var namelist=e.className.split(/\s+/);namelist.push(name);e.className=namelist.join(" ")}},removeClass:function(e,name){if(this.isSupportClassList){e.classList.remove(name)}else{var namelist=e.className.split(/\s+/);for(var i=0;i<namelist.length;i++){if(name==namelist[i]){namelist.splice(i,1)}}e.className=namelist.join(" ")}},clone:function(node){var newNode={};for(var key in node){if(node.hasOwnProperty(key)){newNode[key]=node[key]}}return newNode},cookie:{add:function(name,value,options){HSite.extend(options,{expires:this.getExpire({year:10})});var cookie=name+"="+encodeURIComponent(value);if(options.expires){cookie+=";expires="+options.expires.toGMTString()}if(options.path){cookie+=";path="+options.path}if(options.domain){cookie+=";domain="+options.domain}if(options.bSecure){cookie+=";secure"}document.cookie=cookie},remove:function(name,options){this.setCookie(name,"",Object.extend(options,{expires:new Date(0)}))},get:function(name){var reg=new RegExp("(?:; )?"+name+"=([^;]*);?");if(reg.test(document.cookie)){return decodeURIComponent(RegExp["$1"])}else{return null}},getExpire:function(arg){var today=new Date(),expireYear=today.getFullYear(),expireMonth=today.getMonth(),expireDay=today.getDate();if(arg.year){expireYear=expireYear+arg.year}if(arg.month){expireMonth=expireMonth+arg.month}if(arg.day){expireDay=expireDay+arg.day}return new Date(expireYear,expireMonth,expireDay)}},collect:function(arg){var url="http://www.hao123.com/images/track.gif",r=new Date().getTime(),parameter={level:1,page:window.pageId,r:r,type:"access"},key,obj,ret=[];HSite.extend(arg,parameter);for(key in arg){ret.push(encodeURIComponent(key)+"="+encodeURIComponent(arg[key]))}key="collector"+r;window[key]=obj=new Image();obj.onload=obj.onerror=function(){window[key]=null};parameter.r=key;obj.src=HSite.format("{0}?{1}",url,ret.join("&"))},hover:function(item,className){if(HSite.isIE6){item.onmouseenter=function(){HSite.addClass(this,className)};item.onmouseleave=function(){HSite.removeClass(this,className)}}},setPNG:function(imageSrc){if(HSite.isIE6){obj.style.filter=HSite.format("filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src='{0}')",imageSrc);obj.style.background="none"}}}})(this);var loginModel=(function(c,b){var a=false;return b.extend({_events:{signin:[function(){a=true}]},getLogin:function(){return a},setLogin:function(d,e){a=d;if(d){this.dispatchEvent("signin",e)}}},b.ievent)})(this,HSite);var loginView=(function(b,a){return{onReady:function(e){a.g("pass_login_input_submit_0").value="";a.g("pass_login_label_username_0").innerHTML=loginConfig.userNameText;a.g("pass_login_label_password_0").innerHTML=loginConfig.passWordText1;a.g("pass_login_label_verifycode_0").innerHTML=loginConfig.veryfyCodeText},update:function(g,e,f){},onLoginSuccess:function(e){a.imageRequest(d(),function(){if(e){e()}})},onInputErr:function(e,f){var g=a.g("info");g.style.display="block";switch(f){case"-2":g.innerHTML=a.format(loginConfig.errorText01,c(e.id));break;case"6":g.innerHTML=loginConfig.errorText6;break;case"4":g.innerHTML=loginConfig.errorText4;break;case"1":g.innerHTML=loginConfig.errorText1;break;case"2":g.innerHTML=loginConfig.errorText2;break}},onSystemErr:function(h,g,e){if(g=="110024"){var f=a.format("http://www.hao123.com/registed.htm?resend=1&email={0}&user={1}&tpl=pp",e.mail,a.g("pass_login_username_0").value);a.g("info").innerHTML=a.format(loginConfig.errorText110024,f)}else{a.g("info").innerHTML=loginConfig.errorText00}}};function c(e){if(e.indexOf("username")>-1){return loginConfig.userNameText}else{if(e.indexOf("password")>-1){return loginConfig.passWordText}else{return loginConfig.veryfyCodeText}}}function d(){var e="http://hao123.baidu.com/static/getcookie.php?noredirect=1";if(a.g("pass_login_rem_0").checked){return e+"&is_remember=1"}else{return e}}})(this,HSite);(function(f){var i=f.document,g=0,e=0;var a=Object.prototype.toString.call(f.opera)=="[object Opera]",b=!!(!a&&f.attachEvent),d=!!(b&&!f.XMLHttpRequest);function h(){if(f.innerHeight){return f.innerHeight}else{return i.documentElement.clientHeight}}function c(){if(f.innerWidth){return f.innerWidth}else{return i.documentElement.clientWidth}}function k(){var p=document,m=p.body,o=p.documentElement,n=p.compatMode=="BackCompat"?m:p.documentElement;return Math.max(o.scrollHeight,m.scrollHeight,n.clientHeight)+"px"}function l(o,n){var m=h(),p=c();if(Math.abs(m-g)>10||Math.abs(p-e)>10){g=m;e=p;o.style.left=(p-o.offsetWidth)/2+"px";o.style.top=(f.pageYOffset||i.documentElement.scrollTop)+(m-o.offsetHeight)/2+"px"}}function j(n,m){if(typeof(n)==="string"){n=i.getElementById(n)}this.layer=n;m=m||{};if(m.isModal){this.mask=i.getElementById("popup-mask")}this.text=i.getElementById(n.id+"-text");var o=this;i.getElementById(n.id+"-close").onclick=function(){o.hide();return false};var p=i.getElementById(n.id+"-ok");if(p){if(p.addEventListener){p.addEventListener("click",function(q){o.hide();q.preventDefault()},false)}else{p.attachEvent("onclick",function(){o.hide();f.returnValue=false})}}}j.prototype={show:function(p){var o=this.layer.style,n=this.layer;if(p){this.text.innerHTML=p}this.layer.style.display="";o.left=(c()-n.offsetWidth)/2+"px";o.top=(f.pageYOffset||i.documentElement.scrollTop)+(h()-n.offsetHeight)/2+"px";if(this.mask){this.mask.style.display="";if(d){this.mask.style.height=k()}}var m=this.mask;f.onresize=function(){l(n,m)}},hide:function(){f.onresize=null;this.mask&&(this.mask.style.display="none");this.layer.style.display="none"}};f.Popup=j})(this);function siteControl(m,N,c,M){var k=false;var v={manage:"manage",recover:"recover",refresh:"refresh",back:"back",add:"add"};var i=window.document,K=window.siteConfig,h=m.g("site"),b=m.g("site-hd"),V=m.g("site-bd"),S=m.g("site-tpl"),a=m.g("site-item-add"),f=m.g("site-item-dashed"),C=m.g("site-btn-manage"),l=m.g("site-btn-intoadd"),x=m.g("site-btn-back"),t=m.g("site-btn-recover"),o=m.g("site-button-refresh"),e=m.g("site-item-dashed"),q=m.g("user-bar"),W=m.g("user-set"),B=m.g("user-name"),s=m.g("user-entry"),A=m.g("site-cross"),z=m.g("site-cross-label"),w=m.g("l-left"),r=m.g("l-right");var J=new Popup("p1",{isModal:true}),Q=new Popup("p2",{isModal:true}),P=new Popup("p3",{isModal:true}),I=new Popup("p4",{isModal:true}),D=new Popup("p5",{isModal:true});var y=new SiteDrag(V,e);y.dragable();function p(F){return false}V.itemAdd=a;S.text=m.g("site-text");S.url=m.g("site-url");S.recommend=m.g("site-recommend");S.btnAdd=m.g("site-btn-add");S.btnModify=m.g("site-btn-modify");S.btnCancel=m.g("site-btn-cancel");S.btnForever=m.g("site-btn-forever");S.error=m.g("site-rror");S.error1=m.g("site-error1");S.error2=m.g("site-error2");S.info=m.g("site-info");S.pointer=m.g("site-pointer");m.domReady(function(){E(w,r)});y.addEventListener("premove",function(){y.setIsCanDrag(siteModel.checkStatus(0))});y.addEventListener("sorted",function(){siteModel.sort(siteView.getSortDatas(V))});loginModel.addEventListener("signin",function(F){if(F&&F.isInit){}else{window.setTimeout(function(){siteModel.doImport()},30)}S.btnForever.style.display="none";s&&(s.style.display="none");q.style.display="";B.innerHTML=F.name});siteModel.addEventListener("imported",function(){siteView.doImport(V,siteModel.getData(),S,a,siteModel.getModifyId());siteLog.doImport()});siteModel.addEventListener("error",function(F){siteView.showError(F,S)});siteModel.addEventListener("recovered",function(F){siteModel.setStatus(0);V.onclick=null;siteView.recover(h,b,V,F,S,a);siteView.showButtons([v.manage,v.add])});siteModel.addEventListener("recommended",function(H){siteView.setRecommend(A,H,z);var Y=A.children,F=Y.length;for(var X=0;X<Y.length;X++){Y[X].onclick=function(aa){var Z=siteModel.getRecommendByIndex(this.getAttribute(siteConfig.attr.dataId));if(!L()){return}Z.type=2;Z.obj=this;siteModel.add(Z)}}});siteModel.addEventListener("added",function(F){siteView.onAdded(V,a,F,S);if(F.type==1){siteLog.add(loginModel.getLogin())}else{F.obj.style.display="none";siteLog.recommend(loginModel.getLogin())}siteView.showButtons([v.back,v.recover])});siteModel.addEventListener("modified",function(F){siteView.onModified(V,F,S);siteModel.setStatus(1);if(siteModel.checkIsShowRecover()){siteView.showButtons([v.back,v.recover])}else{siteView.showButtons([v.back])}siteLog.modify(loginModel.getLogin())});siteModel.addEventListener("firsted",function(F){siteView.onFirsted(V,F)});m.on(V,"mousedown",function(F){if(siteModel.getStatus()!=0){return}F=m.fineEvent(F);if(F.target.className!=siteConfig.css.itemText){return}siteLog.doClick(F.target.parentNode.getAttribute("data-id"),F.target.href)});m.on(S,"mousedown",function(F){F=m.fineEvent(F);if(F.srcName=="input"){return}F.stopPropagation();F.preventDefault()});m.on(o,"click",u);m.on(S.text,"keydown",g);m.on(S.url,"keydown",g);m.on(S.btnForever,"click",function(){n()});m.on(m.g("p4-cancel"),"click",function(){I.hide();V.onclick=p});m.on(m.g("p4-ok"),"click",function(){siteModel.recover();siteLog.doReset()});m.on(m.g("p5-cancel"),"click",function(){D.hide()});m.on(m.g("p5-ok"),"click",function(){D.hide();window.setTimeout(function(){n()},0)});m.on(l,"click",function(){d();O();siteLog.intoAdd(loginModel.getLogin())});m.on(C,"click",d);siteControl.onbtnManageClick=d;function d(){siteView.onManageClick(h,b,V,a);siteModel.setStatus(1);V.onclick=p;if(siteModel.checkIsShowRecover()){siteView.showButtons([v.back,v.recover])}else{siteView.showButtons([v.back])}siteLog.manage(loginModel.getLogin());if(m.g("site-new-hint")){m.g("site-new-hint").style.display="none"}}m.on(t,"click",function(){I.show();V.onclick=null});m.on(x,"click",function(){siteView.onBackClick(h,b,V,S,a,siteModel.getData());siteModel.setStatus(0);V.onclick=null;siteView.showButtons([v.manage,v.add]);E(w,r)});m.on(a,"click",O);function O(){if(siteModel.getStatus()==2||!siteView.getTplIsShow()){if(!L()){return}siteView.showTpl(V,S);siteModel.setStatus(3);siteModel.getRecommend(siteConfig.recommendN);return}else{siteView.hideTpl(V,S);siteModel.setStatus(1)}}m.on(S.btnCancel,"click",function(){siteView.onCancelClick(V,S);siteModel.setStatus(1)});m.on(V,"click",function(Z){Z=m.fineEvent(Z);if(Z.srcName=="a"){var F=Z.target.getAttribute("data-type"),aa,Y;if(!F){return}aa=Z.target.getAttribute("data-id"),Y=siteModel.getItemById(aa);switch(F){case"modify":var H=loginModel.getLogin(),X=0;if(!H){X=siteModel.checkLimit(F,aa)}if(X>0){D.show(siteConfig.error[X]);return}siteModel.setModifyItem(Y);siteView.showTpl(V,S,Z.target,Y);siteModel.setStatus(2);break;case"delete":siteView.onOdeleteClick(S,V,Z.target.parentNode);siteModel.doDelete(Y);siteView.showButtons([v.back,v.recover]);siteLog.doDelete(loginModel.getLogin(),aa,Y.url);break}}});m.on(S.btnAdd,"click",function(){var F=siteView.onAddClick(S);F.type=1;if(!L()){return false}if(!U(F,S)){return false}siteView.clearError(S);siteModel.add(F)});m.on(S.btnModify,"click",function(){var H=siteView.onModifyClick(S);if(!U(H,S)){return}var F=siteModel.check(H);if(F>0){siteView.showError(F,S);return}siteModel.modify(H)});function u(){o.onclick=null;siteView.updateNew(V,siteModel.getData());siteView.showButtons([v.manage,v.add]);m.off(o,"click",u)}function E(X,H){var F=H.offsetHeight;if(F<1268){F=1268}X.style.height=F-6+"px"}function g(F){F=m.fineEvent(F);if(F.keyCode==13){window.setTimeout(function(){var H=siteView.onAddClick(S);H.type=1;if(siteModel.getStatus()==3&&!L()){return false}if(!U(H,S)){return false}siteView.clearError(S);if(siteModel.getStatus()==3){siteModel.add(H);siteLog.add(loginModel.getLogin())}else{siteModel.modify(H);siteLog.modify(loginModel.getLogin())}},0)}}function L(){var F=loginModel.getLogin(),H=0;if(!F){H=siteModel.checkLimit()}if(H>0){D.show(siteConfig.error[H]);return false}if(F){H=siteModel.checkFull()}if(H>0){Q.show(siteConfig.error[H]);return false}return true}function U(X,F){var H=siteModel.check(X);if(H>0){siteView.showError(H,F);return false}return true}R();function j(){if(!m.isIE6){return}m.hover(a,"site-item-add-hover");var H=V.children,F=H.length;for(var X=0;X<F;X++){H[X].firstChild.onmouseenter=function(){var Y=siteModel.getStatus();if(Y==0){this.style.cssText="color: #FF3300;text-decoration: underline;"}};H[X].firstChild.onmouseleave=function(){this.style.cssText=""};H[X].children[1].onmouseenter=function(){var Y=siteModel.getStatus();if(Y>0){this.style.cssText="background-position: 0 -37px"}};H[X].children[1].onmouseleave=function(){this.style.cssText=""};H[X].children[2].onmouseenter=function(){var Y=siteModel.getStatus();if(Y>0){this.style.cssText="background-position: -24px -38px"}};H[X].children[2].onmouseleave=function(){this.style.cssText=""}}}window.loginCallback=function(){if(k==true){P.show()}else{k=true;bdPass.api.login.init({outerDomId:"login",u:loginConfig.u,loginType:loginConfig.loginType,staticpage:loginConfig.staticpage,tpl:loginConfig.tpl,onReady:function(){P.show();loginView.onReady()},onInputErr:loginView.onInputErr,onLoginSuccess:function(){var F=arguments[2].username;F=window.decodeURIComponent(F);F=window.decodeURIComponent(F);loginView.onLoginSuccess(function(){P.hide();window.setTimeout(function(){loginModel.setLogin(true,{name:F})},1000);siteLog.login()})},onSystemErr:loginView.onSystemErr})}};function n(){m.callServer("http://passport.baidu.com/v2/api/?getapi&class=login&tpl=pp&tangram=true&callback=loginCallback")}function R(){var X={};X[v.manage]=C;X[v.recover]=t;X[v.back]=x;X[v.refresh]=o;X[v.add]=l;siteView.init(S,X);siteModel.init(M);j();if(N){loginModel.setLogin(true,{isInit:true,name:c});siteLog.defaultLogin()}else{}var H=m.cookie.get("FLASHID"),F=m.cookie.get("BAIDUID");if(!N&&H==null){Model.Index.flashCookie.wait(function(Y){H=m.cookie.get("FLASHID");if(Y&&H!=F){m.ajaxJson(siteConfig.url.init,function(Z){switch(Z.code){case 200:if(Z.data.sites!=null){siteModel.setData(Z.data.sites);siteView.showButtons([v.refresh])}else{siteView.showButtons([v.manage,v.add]);showTemptHint(HSite)}break}});siteLog.flash(1)}else{siteView.showButtons([v.manage,v.add]);showTemptHint(HSite)}if(!Y){siteLog.flash(0)}if(H==F){siteLog.flash(2)}},2000)}else{siteView.showButtons([v.manage,v.add]);showTemptHint(HSite)}}}function showTemptHint(b){var d=b.cookie.get("newUserHint"),g=d?parseInt(d):0;if(g>=3){return}var c=b.g("site-btn-manage"),e=b.getPosition(c),f=window.document.createElement("img"),a=b.g("site-hd").getElementsByTagName("p")[0];f.id="site-new-hint";f.src="http://s0.hao123img.com/index/images/site/hint-0523.gif";f.style.cssText=b.format("height:22px;width:175px; float:right; margin-right:4px;display:inline; cursor:pointer;");a.appendChild(f);f.onclick=function(){siteControl.onbtnManageClick();g++;f.style.display="none";if(g<4){b.cookie.add("newUserHint",g,{expires:b.cookie.getExpire({month:6})})}};setTimeout(function(){f.style.display="none"},1000*60)}function SiteDrag(a,b){this.container=a;this.placeHolder=b;this._events={sorted:[],premove:[]};this._isCanDrag=false;this._moveObjIndex=0}SiteDrag.prototype=HSite.extend({_getMoveObjIndex:function(e){var b=e.parentNode.children,a=b.length,c=0;for(var d=0;d<a;d++){if(b[d]===e){return c}if(b[d]!=this.placeHolder){c++}else{continue}}},setIsCanDrag:function(a){this._isCanDrag=a},dragable:function(){var e=window.document,b=this.container,d=this.placeHolder,a=[],c=this;HSite.on(b,"mousedown",function(i){i=HSite.fineEvent(i);if(i.srcName=="input"){return}i.stopPropagation();i.preventDefault();c.dispatchEvent("premove");if(!c._isCanDrag){return}var f=k(i);if(!f){return}if(HSite.isIE){f.setCapture()}f.style.left=f.offsetLeft+"px";f.style.top=f.offsetTop+"px";b.insertBefore(d,f);c._moveObjIndex=c._getMoveObjIndex(f);d.style.display="block";HSite.addClass(f,siteConfig.css.itemMove);if(!HSite.isIE){HSite.setOpacity(f,0.6)}var m=parseInt(f.style.left),l=parseInt(f.style.top),p=HSite.getMousePos(i),h=p.x,g=p.y;j();e.onmousemove=function(u){u=HSite.fineEvent(u);u.stopPropagation();u.preventDefault();var r=HSite.getMousePos(u),t=r.x,s=r.y;var q=t-h+m,v=s-g+l;if(q>0&&(q+f.offsetWidth<b.offsetWidth-12)){m=q}if(v>0&&(v+f.offsetHeight<b.offsetHeight)){l=v}f.style.left=m+"px";f.style.top=l+"px";h=t;g=s;o(f)};e.onmouseup=function(){i.stopPropagation();i.preventDefault();e.onmousemove=null;e.onmouseup=null;if(HSite.isIE){f.releaseCapture()}if(!HSite.isIE){f.style=""}n(f,function(){if(!HSite.isIE){HSite.setOpacity(f,1)}b.insertBefore(f,d);var q=c._getMoveObjIndex(f);if(q!=c._moveObjIndex){c.dispatchEvent("sorted");c._moveObjIndex=q}HSite.removeClass(f,siteConfig.css.itemMove);b.removeChild(d)})};function k(r){var q;if(r.srcName=="li"&&!HSite.containClass(r.target,siteConfig.css.itemAdd)){return r.target}else{if(r.target.className==siteConfig.css.itemText){return r.target.parentNode}}return false}function j(){a=[];var r=b.children,q=b.children.length;for(var s=0;s<q-1;s++){if(r[s]===d){d.index=s;continue}if(HSite.containClass(r[s],siteConfig.css.itemAdd)){continue}var t={left:r[s].offsetLeft,top:r[s].offsetTop,thisObj:r[s],index:s};t.nextObj=r[s+1];if(t.nextObj===d){t.nextObj=r[s+2]}a.push(t)}}function n(q,A){var s=q.offsetLeft,z=q.offsetTop,r=d.offsetLeft,y=d.offsetTop,v=s,x=z,u=6,t=20;var w=0;if(Math.abs(r-s)<10&&Math.abs(y-z)<10){A();return}window.setTimeout(function(){v+=(r-s)/u;x+=(y-z)/u;q.style.left=v+"px";q.style.top=x+"px";if(w++<u){window.setTimeout(arguments.callee,t)}else{A()}},t)}function o(q){var t=q.offsetLeft,s=q.offsetTop;for(var r=0;r<a.length;r++){if(a[r].thisObj===q){continue}if((Math.abs(a[r].left-t)<q.offsetWidth*0.5)&&(Math.abs(a[r].top-s)<q.offsetHeight*0.3)){if(d.index>a[r].index){b.insertBefore(d,a[r].thisObj)}else{b.insertBefore(d,a[r].nextObj)}j()}}}})}},HSite.ievent);var siteLog=(function(b,a){return{manage:function(c){a.collect({type:"manage",isLogin:c})},login:function(){a.collect({type:"login"})},add:function(c){a.collect({type:"add",isLogin:c})},intoAdd:function(c){a.collect({type:"intoadd",isLogin:c})},recommend:function(c){a.collect({type:"recommend",isLogin:c})},modify:function(c){a.collect({type:"modify",isLogin:c})},doDelete:function(c,e,d){a.collect({type:"delete",isLogin:c,siteId:e,siteUrl:d})},doImport:function(){a.collect({type:"import"})},flash:function(c){a.collect({type:"flash",flashType:c})},defaultLogin:function(){a.collect({type:"defaultLogin"})},doClick:function(d,c){a.collect({type:"click",siteId:d,siteUrl:c})},doReset:function(){a.collect({type:"reset"})}}})(this,HSite);var siteModel=(function(f,h){var c=[],a=[];var g=null;var b=[[false,false,false,false,false,false],[true,true,true,true,true,false],[true,true,true,true,true,false],[true,true,true,true,true,true]],i=0;var e={_events:{added:[],firsted:[],deleted:[],modified:[],recovered:[],recommended:[],needImport:[],imported:[],sorted:[],error:[],refreshed:[]},getStatus:function(){return i},setStatus:function(j){i=j},checkStatus:function(j){return b[i][j]},checkLimit:function(j,m){if(j=="modify"){if(this.getItemById(m).status==siteConfig.guestStatus){return 0}}var l=0;for(var k=0;k<c.length;k++){if(c[k].status==siteConfig.guestStatus){l++}}if(l>=siteConfig.guestMaxLength){return 517}else{return 0}},setData:function(j){c=j},getData:function(){return c},checkIsShowRecover:function(){if(c.length<12){return true}for(var j=0;j<c.length;j++){if(c[j].status==2){return true}}return false},checkFull:function(){if(c.length>=siteConfig.siteMaxlength){return 514}else{return 0}},check:function(k){k.name=k.name.trim();k.url=k.url.trim();if(i==3||(i==2&&k.url!=g.url)){for(var j=0;j<c.length;j++){if(c[j].url==k.url){return 501}}}if(/[&><]+/.test(k.name)){return 510}if(k.url.length>200){return 511}if(k.name.length>siteConfig.nameMaxLength){return 512}if(k.name.length>siteConfig.urlMaxLenth){return 513}if(/^\s*$/.test(k.name)){return 515}if(k.rawUrl.trim().length<=0||/^(https?:\/\/|ftp:\/\/)$/i.test(k.rawUrl.trim())){return 516}return 0},init:function(j){c=j},setModifyItem:function(j){g=j},getModifyId:function(){if(i==2){return g.id}else{return null}},getItemById:function(k){for(var j=0;j<c.length;j++){if(c[j].id==k){return c[j]}}},deleteItemById:function(k){for(var j=0;j<c.length;j++){if(c[j].id==k){c.splice(j,1)}}},sort:function(j){var k=this;h.ajaxJson(siteConfig.url.sort,function(l){switch(l.code){case 200:e.dispatchEvent("sorted");break;case 201:d(l.data.map);e.dispatchEvent("firsted",l.data.map);break;default:e.dispatchEvent("error",500);break}},{type:"post",data:{ids:j}})},needImport:function(){h.ajaxJson(siteConfig.url.needImport,function(j){switch(j.code){case 200:var k=j.data;e.dispatchEvent("needImport",k===1?true:false);break;default:e.dispatchEvent("error",500);break}})},doImport:function(){h.ajaxJson(siteConfig.url.doImport,function(j){switch(j.code){case 200:c=j.data.sites;if(g!=null){for(var k=0;k<c.length;k++){if(c[k].url==g.url){g.id=c[k].id;break}}}e.dispatchEvent("imported");break;default:e.dispatchEvent("error",500);break}})},recover:function(j){h.ajaxJson(siteConfig.url.recover,function(k){switch(k.code){case 200:c=k.data.sites;e.dispatchEvent("recovered",k.data.sites);i=0;break;case 505:e.dispatchEvent("recovered",c);i=0;break;default:e.dispatchEvent("error",500);break}})},add:function(l){var k=this,j={data:l,type:"post"};h.ajaxJson(siteConfig.url.add,function(m){var n=null;switch(m.code){case 201:d(m.data.map);k.dispatchEvent("firsted",m.data.map);case 200:n={name:l.name,url:l.url,id:m.data.id,status:m.data.status,type:l.type,obj:l.obj};c.push(n);k.dispatchEvent("added",n);break;default:k.dispatchEvent("error",m.code);break}},j)},getRecommendByIndex:function(j){return a[j]},getRecommend:function(k){var j=this;k=k||3;h.ajaxJson(h.format("{0}?n={1}",siteConfig.url.recommend,k),function(l){switch(l.code){case 200:a=l.data;j.dispatchEvent("recommended",a);break;default:j.dispatchEvent("error",500);break}})},doDelete:function(k){var j=this;h.ajaxJson(h.format("{0}?id={1}",siteConfig.url.deleteType,k.id),function(l){switch(l.code){case 202:c=l.data.sites;j.dispatchEvent("recovered",c);break;case 201:d(l.data.map);j.dispatchEvent("firsted",l.data.map);case 200:j.deleteItemById(k.id);break;default:j.dispatchEvent("error",500);break}})},modify:function(l){l.id=g.id;var k=this,j={data:l,type:"post"};h.ajaxJson(siteConfig.url.modify,function(m){var n=null;switch(m.code){case 201:d(m.data.map);k.dispatchEvent("firsted",m.data.map);case 200:g.name=l.name;g.url=l.url;g.oldId=g.id;g.id=m.data.id;g.status=m.data.status;k.dispatchEvent("modified",g);break;default:k.dispatchEvent("error",m.code);break}},j)}};h.extend(e,h.ievent);return e;function d(k){for(var j=0;j<c.length;j++){c[j].id=k[c[j].id]}}})(this,HSite);var siteView=(function(window,H){var doc=window.document,configCss=window.siteConfig.css,configSug=window.siteConfig.sug,configSugwrap=window.siteConfig.sugWrap,configError=window.siteConfig.error;var _tplIshow=false;var _buttons={};var siteBdWrapper=H.g("site-bd-wrapper");return H.extend({_events:{updated:[]},getTplIsShow:function(){return _tplIshow},showButtons:function(names){for(var item in _buttons){_buttons[item].style.display="none"}for(var i=0;i<names.length;i++){_buttons[names[i]].style.display=""}},setTplIsShow:function(v){_tplIshow=v},getSortDatas:function(bd){var items=bd.children,len=items.length,result=[];for(var i=0;i<len-1;i++){var sortId=items[i].getAttribute("data-id");if(sortId&&String(sortId).trim()!=""){result.push(sortId)}}return result.join(",")},showRecommend:function(recommend){recommend.style.display=""},setRecommend:function(siteCross,data,siteCrossLabel){var html=[];for(var i=0;i<data.length;i++){html.push(H.format(siteConfig.crossTpl,data[i].name.substring(0,siteConfig.recommendMaxWord),i,data[i].name))}if(html.length>0){siteCrossLabel.style.display=""}else{siteCrossLabel.style.display="none"}siteCross.innerHTML=html.join("")},updateNew:function(bd,data){var thisObj,e;thisObj=this;e=siteBdWrapper;function expand(){var oldValue,targetValue;baidu.fx.create(e,{initialize:function(){oldValue=e.offsetHeight;thisObj.update(bd,data);targetValue=e.offsetHeight;e.style.overflow="hidden";e.style.height=oldValue+"px"},transition:function(percent){return(-Math.cos(percent*Math.PI)/2)+0.5},render:function(schedule){e.style.height=Math.floor(oldValue+schedule*(targetValue-oldValue))+"px"},finish:function(){e.style.overflow="visible";e.style.height="auto"}}).launch()}T.fx.fadeOut(e,{onafterfinish:function(){T.fx.fadeIn(e);expand()}})},update:function(bd,data,cname){var html=[];cname=cname||configCss.itemNormal;for(var i=0;i<data.length;i++){var normalItem=H.format(siteConfig.bdTpl.item,cname,"{0}",siteConfig.bdTpl.innerItem);var name=fineName(data[i].name);var url=data[i].url.replace(/[><]/g,"");html.push(H.format(normalItem,data[i].id,data[i].name.replace(/[><]/g,""),url,showName(name)))}bd.innerHTML=html.join("")},doImport:function(bd,data,tpl,itemdd,modifyItemId){bd.removeChild(itemdd);if(_tplIshow){bd.removeChild(tpl)}this.update(bd,data,configCss.itemEdit);bd.appendChild(itemdd);this.showTpl(bd,tpl,null,null);var items=bd.children,len=items.length;for(var i=0;i<len;i++){var id=items[i].getAttribute("data-id");if(id&&id==modifyItemId){H.removeClass(items[i],configCss.itemEdit);H.addClass(items[i],configCss.itemCurrent);break}}if(i>=len){tpl.text.value="";tpl.url.value=""}},recover:function(site,hd,bd,items,tpl,addBtn){bd.removeChild(addBtn);this.hideTpl(bd,tpl);this.update(bd,items);H.removeClass(site,configCss.edit);H.addClass(site,configCss.normal);H.removeClass(hd,configCss.hdEdit);H.addClass(hd,configCss.hdNormal)},init:function(tpl,buttons){_buttons=buttons;_tplIshow=false;configSug.templ=function(data,q){var result=[],s=data.s,keys={};for(var i=0,len=0;i<s.length&&len<siteConfig.sug.n;i++){var item=eval("("+s[i].split(configSugwrap.splitChar)[1]+")");item[1]=item[1]||"";if(!item[4]){continue}item[4]=item[4]||"";if(!keys[item[4]]){len++;keys[item[4]]=true;result.push(H.format(configSugwrap.itemTpl,item[1],item[4],item[1].replace(q,H.format("<strong>{0}</strong>",q)),item[4].replace(q,H.format("<strong>{0}</strong>",q))))}}if(result.length<=0){return null}else{return H.format(configSugwrap.mainTpl,result.join(""))}};configSug.onSelect=function(text,url){if(!text||!url){return}tpl.text.value=text;tpl.url.value=url;urlG.s=null};configSug.onEnable=function(element){var obj=element.id===tpl.text.id?tpl.url:tpl.text;if(obj.value.trim().length>0){return false}else{return true}};var textG=G.sug(tpl.text,configSug),urlG=G.sug(tpl.url,configSug)},onAddClick:function(tpl){return{name:fineName(tpl.text.value),url:fineUrl(tpl.url.value),rawName:tpl.text.value,rawUrl:tpl.url.value}},onModifyClick:function(tpl){return{name:fineName(tpl.text.value),url:fineUrl(tpl.url.value),rawName:tpl.text.value,rawUrl:tpl.url.value}},onCancelClick:function(bd,tpl){this.hideTpl(bd,tpl);removeCurrent(bd);setTitle(bd.children,siteConfig.bdTpl.dragHint)},showTpl:function(bd,tpl,target,item){tpl.text.value="";tpl.url.value="";tpl.error1.innerHTML="";tpl.error2.innerHTML="";removeCurrent(bd);bd.appendChild(tpl);H.removeClass(bd,configCss.bdNormal);if(!target){tpl.btnAdd.style.display="";tpl.btnModify.style.display="none";tpl.recommend.style.display="";tpl.text.focus()}else{target=target.parentNode;H.removeClass(target,configCss.itemEdit);H.addClass(target,configCss.itemCurrent);tpl.text.value=fineName(item.name);tpl.url.value=fineUrl(item.url);tpl.btnAdd.style.display="none";tpl.btnModify.style.display="";tpl.recommend.style.display="none"}_tplIshow=true},hideTpl:function(bd,tpl){if(_tplIshow){bd.removeChild(tpl);_tplIshow=false}H.addClass(bd,configCss.bdNormal)},onItemAddClick:function(bd,tpl,isLogin){tpl.text.value="";tpl.url.value="";tpl.btnAdd.style.display="";tpl.btnModify.style.display="none";tpl.recommend.style.display="";tpl.error1.innerHTML="";tpl.error2.innerHTML="";if(!isLogin){tpl.btnForever.style.display=""}else{tpl.btnForever.style.display="none"}setTitle(bd.children,false,tpl);if(this.checkTplIsShow(bd,tpl)){bd.removeChild(tpl);return 1}bd.appendChild(tpl);return 3},onManageClick:function(site,hd,bd,addBtn){H.removeClass(site,configCss.normal);H.addClass(site,configCss.edit);H.removeClass(hd,configCss.hdNormal);H.addClass(hd,configCss.hdEdit);var i=0,len=bd.children.length,items=bd.children;for(i=0;i<len;i++){H.removeClass(items[i],configCss.itemNormal);H.addClass(items[i],configCss.itemEdit)}setTitle(bd.children,siteConfig.bdTpl.dragHint);bd.appendChild(addBtn)},onBackClick:function(site,hd,bd,tpl,addBtn,siteData){bd.removeChild(addBtn);H.removeClass(site,configCss.edit);H.addClass(site,configCss.normal);H.removeClass(hd,configCss.hdEdit);H.addClass(hd,configCss.hdNormal);if(_tplIshow){this.hideTpl(bd,tpl)}var i=0,len=bd.children.length,items=bd.children;for(i=0;i<len;i++){H.removeClass(items[i],configCss.itemEdit);H.removeClass(items[i],configCss.itemCurrent);H.addClass(items[i],configCss.itemNormal)}setTitle(bd.children,false)},onOdeleteClick:function(tpl,bd,item){if(H.containClass(item,configCss.itemCurrent)){bd.removeChild(tpl);_tplIshow=false}bd.removeChild(item)},onAdded:function(bd,addBtn,item,tpl){var container=document.createElement(siteConfig.bdTpl.bdtag);var editItem=H.format(siteConfig.bdTpl.item,configCss.itemEdit,"{0}",siteConfig.bdTpl.innerItem);container.innerHTML=H.format(editItem,item.id,item.name,item.url,showName(fineName(item.name)));bd.insertBefore(container.firstChild,addBtn);tpl.text.value="";tpl.url.value=""},onModified:function(bd,item,tpl){var lis=bd.children,len=lis.length;for(var i=0;i<len;i++){if(lis[i].getAttribute("data-id")==item.oldId){lis[i].setAttribute("data-id",item.id);lis[i].innerHTML=H.format(siteConfig.bdTpl.innerItem,item.id,item.name,item.url,showName(fineName(item.name)));H.removeClass(lis[i],configCss.itemCurrent);H.addClass(lis[i],configCss.itemEdit);break}}this.hideTpl(bd,tpl)},onFirsted:function(bd,mapIds){var items=bd.getElementsByTagName("*"),len=items.length;for(var i=0;i<len;i++){var id=items[i].getAttribute(siteConfig.attr.dataId);if(id){items[i].setAttribute(siteConfig.attr.dataId,mapIds[id])}}},showInfo:function(tpl,info){tpl.error1.innerHTML="";tpl.error2.innerHTML="";tpl.recommend.style.display="none";tpl.info.innerHTML=info},clearError:function(tpl){tpl.error1.innerHTML="";tpl.error2.innerHTML=""},showError:function(code,tpl){tpl.recommend.style.display="none";tpl.info.innerHTML="";switch(code){case 500:case 510:case 512:case 514:case 515:tpl.error1.innerHTML=siteConfig.error[code];tpl.error2.innerHTML="";break;case 501:case 511:case 513:case 516:tpl.error2.innerHTML=siteConfig.error[code];tpl.error1.innerHTML="&nbsp;&nbsp;";break}}},H.ievent);function fineName(s){s=s.trim();s=s.replace(/[&\s<>]/g,"");s=s.replace("　","");s=s.replace("nbsp;","");s=s.replace("&#12288;","");return s}function fineUrl(s){s=s.trim();s=s.toLowerCase();if(!(/^(https?:\/\/.*|ftp:\/\/.*)$/i.test(s))){s="http://"+s}s=s.replace(/[\s><]/g,"");return s}function showName(s){if(s.length===2){s=s.charAt(0)+"&#12288;"+s.charAt(1)}if(s.length===3){s=s.charAt(0)+"&nbsp;"+s.charAt(1)+"&nbsp;"+s.charAt(2)}return s}function setTitle(items,title,tpl){var len=items.length,t;for(var i=0;i<len;i++){if(tpl&&items[i]===tpl){continue}if(H.containClass(items[i],configCss.itemAdd)){continue}if(H.containClass(items[i],siteConfig.css.itemDashed)){continue}if(H.containClass(items[i],siteConfig.css.itemAdd)){continue}t=title?title:items[i].firstChild.innerHTML;t=t.replace(/&nbsp;/g," ");items[i].firstChild.setAttribute("title",t)}}function removeCurrent(bd){var items=bd.children,len=items.length;for(var i=0;i<len;i++){if(H.containClass(items[i],configCss.itemCurrent)){H.removeClass(items[i],configCss.itemCurrent);H.addClass(items[i],configCss.itemEdit)}}}})(this,HSite);